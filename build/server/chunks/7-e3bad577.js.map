{"version":3,"file":"7-e3bad577.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/(app)/chatrooms/_slug_/edit/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/7.js"],"sourcesContent":["import { d as db } from \"../../../../../../chunks/database.js\";\nimport { f as fail, r as redirect } from \"../../../../../../chunks/index.js\";\nconst load = async ({ params }) => {\n  try {\n    const roomId = parseInt(params.slug);\n    const room = await db.room.findUnique({\n      where: {\n        id: roomId\n      }\n    });\n    return {\n      room\n    };\n  } catch (err) {\n    console.error(\"Error: \", err);\n    return fail(500, { error: { message: \"Internal server error\" } });\n  }\n};\nconst actions = {\n  rename: async ({ params, request }) => {\n    try {\n      const roomId = parseInt(params.slug);\n      const data = await request.formData();\n      const newName = data.get(\"newName\")?.toString();\n      if (newName && (newName.length > 15 || newName.length < 3)) {\n        throw \"Name is too long or too short\";\n      }\n      await db.room.update({\n        where: {\n          id: roomId\n        },\n        data: {\n          name: newName\n        }\n      });\n    } catch (err) {\n      console.error(\"Error: \", err);\n      return fail(500, { error: { message: \"Internal server error\" } });\n    }\n  },\n  exit: async ({ locals, params }) => {\n    try {\n      const roomId = parseInt(params.slug);\n      const userId = parseInt(locals.user.id);\n      const room = await db.room.findUnique({\n        where: { id: roomId },\n        include: { users: true }\n        // Include users for filtering\n      });\n      if (!room) {\n        return fail(400, { error: { message: \"Missing room ID\" } });\n      }\n      if (room.users.length == 1) {\n        await db.room.update({\n          where: { id: roomId },\n          data: {\n            users: {\n              disconnect: { id: userId }\n              // Disconnect the specific user\n            }\n          }\n        });\n        await db.room.delete({\n          where: { id: roomId }\n        });\n        console.log(\"deleted\");\n      } else {\n        await db.room.update({\n          where: { id: roomId },\n          data: {\n            users: {\n              disconnect: { id: userId }\n              // Disconnect the specific user\n            }\n          }\n        });\n      }\n    } catch (error) {\n      console.error(\"Error removing user:\", error);\n      return fail(500, { error: { message: \"Internal server error\" } });\n    }\n    throw redirect(302, \"/chatrooms\");\n  }\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/(app)/chatrooms/_slug_/edit/_page.server.ts.js';\n\nexport const index = 7;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/(app)/chatrooms/_slug_/edit/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/(app)/chatrooms/[slug]/edit/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/7.5bb58587.js\",\"_app/immutable/chunks/index.229400e6.js\",\"_app/immutable/chunks/forms.4c325e09.js\",\"_app/immutable/chunks/parse.bee59afc.js\",\"_app/immutable/chunks/singletons.dd9c9a0a.js\",\"_app/immutable/chunks/navigation.71f60e69.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}